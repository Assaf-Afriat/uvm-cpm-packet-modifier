# UVM Verification Coding Guidelines and Best Practices

## General Coding Standards

### Naming Conventions
- **Class names**: PascalCase (e.g., `MyDriver`, `MySequence`)
- **Member variables**: `m_` prefix (e.g., `m_driver`, `m_sequencer`)
- **Method arguments**: `i_` for input, `o_` for output, `io_` for inout (e.g., `i_txn`, `o_data`)
- **Constants**: UPPER_SNAKE_CASE or `localparam` (e.g., `REPEAT_COUNT`)

### File Headers
Every file must have a header with:
- `// FILE: filename.sv`
- `// DESCRIPTION: Brief description`
- `// AUTHOR: Your name`
- `// DATE: YYYY-MM-DD`

### Function/Class Documentation
- Use `// FCN: function_name` for functions
- Use `// TASK: task_name` for tasks
- Use `// CLASS: ClassName` for classes
- Include `// DESCRIPTION:` and `// PARAMETERS:` sections

### Code Organization
- Remove all `//---` separator lines from comments
- Keep FCN comments minimal: only description and name
- No unnecessary forward declarations (only use when circular dependencies exist)

## UVM-Specific Guidelines

### Component Structure
1. **Factory Registration**: Always use `uvm_component_utils` or `uvm_object_utils`
2. **Constructor**: Always call `super.new(name, parent)` with proper arguments
3. **Phases**: Use appropriate UVM phases (`build_phase`, `connect_phase`, `run_phase`)

### Configuration
- Use `uvm_config_db` with wildcard paths (`"*"`) when setting config for child components
- Retrieve config using appropriate context (sequencer for sequences, component for components)
- Avoid redundancy: don't set config and then immediately retrieve it in the same component

### Factory Overrides
- **CRITICAL**: Factory overrides must be set in `build_phase` BEFORE creating the component being overridden
- Example: `MyDriver::type_id::set_type_override(LoudDriver::get_type());` before `m_env = MyEnv::type_id::create(...)`

### Callbacks
- **CRITICAL**: Callbacks must be registered in `connect_phase`, NOT `run_phase`
- Use `uvm_register_cb(ComponentClass, CallbackClass)` in the component class
- Use `uvm_do_callbacks(ComponentClass, CallbackClass, callback_method(args))` to invoke
- Callback classes should be in separate files, not inside packages

### Inheritance and Overrides
- When overriding behavior, extract the variable part into a virtual function
- Don't override entire `run_phase` tasks just to change one line
- Example: Create `virtual function void print_message(string i_msg)` instead of overriding `run_phase`

### Package Organization
- Keep callback classes in separate files
- Keep sequencer classes in separate files (not typedefs)
- Include files in dependency order
- Remove unnecessary forward declarations

### Test Structure
- Create base test classes for common setup
- Derive specific tests for different scenarios
- Use `localparam` for magic numbers instead of hardcoded values
- Separate tests for different behaviors (factory override, callbacks, etc.)

### Sequences
- Sequences should retrieve configuration from `uvm_config_db` themselves
- Use `m_sequencer` context with wildcard path when retrieving config
- Don't pass configuration through sequence properties when config_db can be used

### TLM Connections
- Use `uvm_analysis_port` in monitors
- Use `uvm_analysis_imp` in subscribers (scoreboards, etc.)
- Connect in `connect_phase`: `monitor.m_ap.connect(scoreboard.m_export)`

## Code Quality

### Error Handling
- Use `uvm_fatal` for configuration errors that prevent simulation
- Use `uvm_warning` for recoverable issues
- Use `uvm_info` with appropriate verbosity levels

### Magic Numbers
- Replace all magic numbers with named constants (`localparam` or `const`)
- Example: `localparam int REPEAT_COUNT = 5;` instead of hardcoded `5`

### Visibility
- Make component handles public when they need to be accessed by tests or parent components
- Use `local` only when truly internal to the component

## QuestaSim/Simulation
- Use `+incdir+..` for include directories
- Compile packages first, then testbenches
- Handle test names via command line arguments in Python scripts

## When Writing Code
- Always follow these guidelines
- Check for common mistakes (factory override timing, callback phase, config paths)
- Ensure all components are properly connected in `connect_phase`
- Verify that sequences can retrieve their configuration
- Make sure callbacks are registered before components start running
